<!DOCTYPE html>
<html lang="en">
<head>
  <title>mLive</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="example-page.css">
  <script src="https://mobile-content.sessionm.com/javascripts/api/sessionm.min.js" type="text/javascript"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <!-- Glyph icons provided by http://glyphicons.com -->
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">mLive</a>
    </div>
    <div>
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">Menu
          <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li>
              <a href="#" onclick="openPortal()">mLive Rewards
              <span class="badge" id="achievementCount"></span>
              <span class="glyphicon glyphicon-chevron-right"></span></a>
            </li>
            <li><a href="#" onclick="sendTestAction()">Read article</a></li>
          </ul>
        </li>
        <li><div id="nav_bar_button_widget_container"></div></li>
      </ul>
    </div>
  </div>
</nav>


<div class="container">
  <div class="jumbotron">
    <h1>mLive</h1>
  </div>

  <button type="button" id="present_modal_btn" data-toggle="modal" data-target="#welcome_modal"></button>
  <div class="modal fade" id="welcome_modal" role="dialog">
    <div class="modal-dialog modal-sm">
      <div class="modal-content info-container">
        <div class="modal-header">
          <button type="button" class="close" id="close_modal_btn" data-dismiss="modal">&times;</button>
          <img src="Resources/GiftBox50x50@2x.png">
          <h1 class="modal-title">Earn<br/>Points</h1>
        </div>
        <div class="modal-body">
          <p class="info-text">Earn points toward great prizes simply by enjoying our articles, galleries and newsletters.</p>
          <a class="btn btn-primary btn-block info-btn" href="https://sessionm.zendesk.com/hc/en-us/articles/200161296-What-Are-mPOINTS-" target="_blank" onclick="closeWelcomeModal()">Learn More
          <span class="glyphicon glyphicon-chevron-right"></span></a>
        </div>
      </div>
    </div>
  </div>

  <div class="info-container" id="right_rail_container">
    <div id="info_header">
      <img src="Resources/GiftBox50x50@2x.png">
      <h1 id="info_header_text">Earn<br/>Points</h1>
    </div>
    <div id="info_body">
      <p class="info-text">Earn points toward great prizes simply by enjoying our articles, galleries and newsletters.</p>
      <a class="btn btn-primary btn-block info-btn" href="https://sessionm.zendesk.com/hc/en-us/articles/200161296-What-Are-mPOINTS-" target="_blank">Learn More
      <span class="glyphicon glyphicon-chevron-right"></span></a>
    </div>
  </div>
	
  <div id="achievement_widget_container">
    <div class="row">
      <div class="col-xs-1">
        <img src="Resources/GiftBox40x40.png">
      </div>
      <div class="col-xs-4">
        <span class="achievement-text" id="achievement_name"></span>
        <p id="achievement_message"></p>
      </div>
      <div class="col-xs-3">
        <span class="achievement-text" id="achievement_point_value"></span>
      </div>
      <div class="col-xs-4">
        <button type="button" class="btn btn-primary" onclick="claimCustomAchievement()">CLAIM ACHIEVEMENT</button>
      </div>
    </div>
  </div>

  <div class="container" id="bar_widget_container"></div>
</div>

<script type="text/javascript">
  presentWelcomeModal();

  var navBarButtonWidget = new sessionm.widget({ appID : "1902bc9c7e4917a0c090111e0aaf1922565ef712",
                                                 style : "button" });
  navBarButtonWidget.embed("nav_bar_button_widget_container", console.log("Initialized nav bar button widget"));

  var barWidget = new sessionm.widget({ appID : "1902bc9c7e4917a0c090111e0aaf1922565ef712",
                                        style : "bar" });
  barWidget.embed("bar_widget_container", console.log("Initialized bar widget"));

  var achievementWidget = new sessionm.widget({ appID : "1902bc9c7e4917a0c090111e0aaf1922565ef712",
                                                style : "custom" });
  achievementWidget.embed("achievement_widget_container", console.log("Initialized achievement widget"));

  sessionm.addEventListener("userUpdated", function(user) { updateAchievementCount();});

  function presentWelcomeModal() {
    document.getElementById("present_modal_btn").click();
  }

  function closeWelcomeModal() {
    document.getElementById("close_modal_btn").click();
  }

  function sendTestAction() {
    achievementWidget.sendAction("test", {
      alertStyle : "custom",
      throttleByUrlUniqueness : false,
      callback : function(action, earned, achievement) {
        console.log("Sent test action");
        if (earned) {
          console.log("Earned achievement");
          var achievementWidgetContainer = document.getElementById("achievement_widget_container");
          achievementWidgetContainer.style.display = "block";
          document.getElementById("achievement_name").innerHTML = achievement.getName();
          document.getElementById("achievement_message").innerHTML = achievement.getMessage();
          document.getElementById("achievement_point_value").innerHTML = achievement.getPointValue() + " points";
        }
      }
    });
  }

  function claimCustomAchievement() {
    console.log("Claimed achievement");
    var achievementWidgetContainer = document.getElementById("achievement_widget_container");
    achievementWidgetContainer.style.display = "none";    
    achievementWidget.openPortal({achievements : true});
  }

  function openPortal() {
    sessionm.openPortal();
  }

  function updateAchievementCount() {
    document.getElementById("achievementCount").innerHTML = String(sessionm.getUser().getUnclaimedAchievementCount());
  }

</script>

</body>
</html>
